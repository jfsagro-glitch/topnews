"""
–û—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ –æ—Ç HTML –∏ –ª–∏—à–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
"""
import re
import os
from html import unescape
from bs4 import BeautifulSoup
import logging

# –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è —Å—Ç—Ä–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏/—Å–ª—É–∂–µ–±–Ω—ã—Ö –±–ª–æ–∫–æ–≤
NAVIGATION_KEYWORDS = {
    '–≥–ª–∞–≤–Ω–æ–µ', '—Ä–æ—Å—Å–∏—è', '–º–∏—Ä', '–ø–æ–ª–∏—Ç–∏–∫–∞', '–æ–±—â–µ—Å—Ç–≤–æ', '–ø—Ä–æ–∏—Å—à–µ—Å—Ç–≤–∏—è', '–∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã',
    '–ø—Ä–µ—Å—Ç—É–ø–Ω–æ—Å—Ç—å', '—ç–∫–æ–Ω–æ–º–∏–∫–∞', '—Å–ø–æ—Ä—Ç', '–Ω–∞—É–∫–∞', '–∫—É–ª—å—Ç—É—Ä–∞', '—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏', '—Ü–µ–Ω–Ω–æ—Å—Ç–∏',
    '–ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è', '–∂–∏–∑–Ω–∏', '–≤–µ—Ä–Ω—É—Ç—å—Å—è', '–æ–±—ã—á–Ω—É—é', '–ª–µ–Ω—Ç—É', '–≤–æ–π—Ç–∏', '—Ä–µ–∫–ª–∞–º–∞', '–≤—Å–µ',
    '–Ω–æ–≤–æ—Å—Ç–∏', '—Ä–µ–¥–∞–∫—Ü–∏—è', '–∫–æ–Ω—Ç–∞–∫—Ç—ã', '–ø–æ–¥–ø–∏—Å–∫–∞', '–ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è', 'rss', 'search', 'menu',
    'mobile', '–∫–∞–Ω–∞–ª', 'telegram', 'vk', '–≤–∫–æ–Ω—Ç–∞–∫—Ç–µ', '–æ–¥–Ω–æ–∫–ª–∞—Å—Å–Ω–∏–∫–∏', 'rutube', 'tiktok',
    'youtube', 'dzen', 'mail', 'smi2', '–∫–∞—Ä—Ç–∏–Ω–∞', '–¥–Ω—è', '–ª–µ–Ω—Ç–∞', '–¥–æ–±—Ä–∞', 'partners',
    'partner–æ–≤', '–ø—Ä–µ—Å—Å-—Ä–µ–ª–∏–∑—ã', 'promo', '—à–∫–æ–ª–∞', '–æ–∫–Ω–æ', '—Ä–æ—Å—Å–∏—é', 'rt', 'programmy',
    '—Ç–µ–∫—É—â–∏–µ', '–∑–∞–∫—É–ø–∫–∏', '–ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤', '–æ–±—Å—É–¥–∏—Ç—å', '–æ—Ü–µ–Ω–∏', '—Å–æ–≥–ª–∞—à–µ–Ω–∏–µ', 'cookies'
}

SOCIAL_DOMAINS = (
    'vk.com', 'vkvideo', 'telegram', 't.me', 'ok.ru', 'youtube', 'rutube', 'max.ru',
    'smi2.ru', 'twitter', 'instagram', 'facebook', 'zen.yandex', 'dzen.ru'
)

NAVIGATION_PATTERNS = [
    re.compile(r'^\d{1,2}:\d{2}(,\s*\d{1,2}\s+[–∞-—è]+\s+\d{4})?(\s+[–∞-—è]+)?$', re.IGNORECASE),
    re.compile(r'–≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –æ–±—ã—á–Ω—É—é –ª–µ–Ω—Ç—É', re.IGNORECASE),
    re.compile(r'—á—Ç–æ –¥—É–º–∞–µ—à—å\?\s*–æ—Ü–µ–Ω–∏', re.IGNORECASE),
    re.compile(r'–æ—à–∏–±–∫–∞ –≤ —Ç–µ–∫—Å—Ç–µ\?', re.IGNORECASE),
    re.compile(r'–Ω–∞—à–ª–∏ –æ–ø–µ—á–∞—Ç–∫—É', re.IGNORECASE),
    re.compile(r'—Å–µ–≥–æ–¥–Ω—è –≤ —Å–º–∏', re.IGNORECASE),
    re.compile(r'–Ω–æ–≤–æ—Å—Ç–∏ —Å–º–∏2', re.IGNORECASE),
    re.compile(r'–ª–µ–Ω—Ç–∞ –Ω–æ–≤–æ—Å—Ç–µ–π', re.IGNORECASE),
    re.compile(r'–∫–∞—Ä—Ç–∏–Ω–∞ –¥–Ω—è', re.IGNORECASE),
    re.compile(r'–ø–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏', re.IGNORECASE),
    re.compile(r'–º–∞—Ç–µ—Ä–∏–∞–ª—ã –ø–æ —Ç–µ–º–µ', re.IGNORECASE),
    re.compile(r'–ø–æ—Ö–æ–∂–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã', re.IGNORECASE),
    re.compile(r'english\s+deutsch\s+fran√ßais', re.IGNORECASE),
    re.compile(r'–∞–≤—Ç–æ–Ω–æ–º–Ω–∞—è –Ω–µ–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è', re.IGNORECASE),
    re.compile(r'–≥–ª–∞–≤–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä', re.IGNORECASE),
    re.compile(r'–∞–¥—Ä–µ—Å —Ä–µ–¥–∞–∫—Ü–∏–∏', re.IGNORECASE),
    re.compile(r'—Ç–µ–ª–µ—Ñ–æ–Ω:\s*\+7', re.IGNORECASE),
]

logger = logging.getLogger(__name__)


def clean_html(html_text: str) -> str:
    """
    –û—á–∏—â–∞–µ—Ç HTML –æ—Ç —Ç–µ–≥–æ–≤ –∏ –ª–∏—à–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    –£–±–∏—Ä–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã –∏ –ø–µ—Ä–µ–Ω–æ—Å—ã
    """
    if not html_text:
        return ""
    
    try:
        # –£–¥–∞–ª—è–µ–º —Å–∫—Ä–∏–ø—Ç—ã –∏ —Å—Ç–∏–ª–∏
        # –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–ª–∏ –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É ‚Äî –æ—Ç–∫—Ä–æ–µ–º —Ñ–∞–π–ª, –∏–Ω–∞—á–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç—Ä–æ–∫–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
        if isinstance(html_text, str) and os.path.exists(html_text):
            try:
                with open(html_text, 'r', encoding='utf-8', errors='ignore') as fh:
                    content = fh.read()
            except Exception:
                content = str(html_text)
        else:
            content = str(html_text)

        # If input doesn't contain HTML tags, treat as plain text to avoid
        # BeautifulSoup MarkupResemblesLocatorWarning when content looks like a filename.
        if '<' not in content and '>' not in content:
            text = unescape(content)
            text = re.sub(r'\s+', ' ', text).strip()
            return text

        soup = BeautifulSoup(content, 'html.parser')

        for tag in soup(['script', 'style', 'noscript']):
            tag.decompose()

        # –ë–µ—Ä—ë–º —Ç–µ–∫—Å—Ç —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≥—Ä–∞–Ω–∏—Ü –±–ª–æ–∫–æ–≤
        text = soup.get_text(separator='\n')
        
        # –£–±–∏—Ä–∞–µ–º HTML entities
        text = unescape(text)

        # –§–∏–ª—å—Ç—Ä—É–µ–º –º—É—Å–æ—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç –æ—Ç –†–ò–ê –ù–æ–≤–æ—Å—Ç–∏ (—Ñ–æ—Ä–º—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)
        junk_patterns = [
            r'–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–π–¥–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ',
            r'–ü–æ–∂–∞–ª—É–π—Å—Ç–∞.*–ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ –∏–∑ –ø–∏—Å—å–º–∞',
            r'–û—Ç–ø—Ä–∞–≤–∏—Ç—å –µ—â–µ —Ä–∞–∑',
            r'–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑',
            r'–ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å',
            # Telegram –∫–∞–Ω–∞–ª –º—É—Å–æ—Ä (–∫–æ–Ω–∫—É—Ä—Å—ã, –ø—Ä–∏–∑—ã–≤—ã, —Å–º–∞–π–ª–∏–∫–∏)
            r'[‚ò∫üòäüéâüéÅ]+\s*–í—ã–∏–≥—Ä–∞—Ç—å.*[‚Äî-]\s*–∑–¥–µ—Å—å',
            r'–ü—Ä–∏—Å–ª–∞—Ç—å –Ω–æ–≤–æ—Å—Ç—å',
            r'–í—ã–∏–≥—Ä–∞—Ç—å\s+–∞–π—Ñ–æ–Ω[—ã–∞]?',
            r'–ö–æ–Ω–∫—É—Ä—Å\s*[‚Äî-]\s*–∑–¥–µ—Å—å',
            r'–ù–∞–ø–∏—Å–∞—Ç—å\s+–Ω–∞–º',
            r'–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è\s+–Ω–∞\s+–∫–∞–Ω–∞–ª',
            r'[‚ò∫üòäüéâüéÅüî•üí•‚ö°]+\s*[–ê-–Ø–∞-—è\s]+\s*[‚Äî-]\s*–∑–¥–µ—Å—å',
            # –ú–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ Lenta.ru
            r'–ì–ª–∞–≤–Ω–æ–µ –†–æ—Å—Å–∏—è –ú–∏—Ä –ë—ã–≤—à–∏–π –°–°–°–† –≠–∫–æ–Ω–æ–º–∏–∫–∞ –°–∏–ª–æ–≤—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã',
            r'–ù–∞—É–∫–∞ –∏ —Ç–µ—Ö–Ω–∏–∫–∞ –ê–≤—Ç–æ –ö—É–ª—å—Ç—É—Ä–∞ –°–ø–æ—Ä—Ç –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –∏ –°–ú–ò',
            r'–¶–µ–Ω–Ω–æ—Å—Ç–∏ –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è –ò–∑ –∂–∏–∑–Ω–∏ –°—Ä–µ–¥–∞ –æ–±–∏—Ç–∞–Ω–∏—è –ó–∞–±–æ—Ç–∞ –æ —Å–µ–±–µ',
            r'–¢–µ–ø–µ—Ä—å –≤—ã –∑–Ω–∞–µ—Ç–µ –í–æ–π—Ç–∏ –≠–∫—Å–∫–ª—é–∑–∏–≤—ã –°—Ç–∞—Ç—å–∏ –ì–∞–ª–µ—Ä–µ–∏ –í–∏–¥–µ–æ',
            r'–°–ø–µ—Ü–ø—Ä–æ–µ–∫—Ç—ã –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –ú–∏–Ω–∏-–∏–≥—Ä—ã –ê—Ä—Ö–∏–≤ –õ–µ–Ω—Ç–∞ –¥–æ–±—Ä–∞',
            r'–•–æ—á–µ—à—å –≤–∏–¥–µ—Ç—å —Ç–æ–ª—å–∫–æ',
            # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è Lenta.ru
            r'–£—Ö–æ–¥ –∑–∞ —Å–æ–±–æ–π:\s*–ó–∞–±–æ—Ç–∞ –æ —Å–µ–±–µ:\s*Lenta\.ru',
            r'–ü–æ–ª–∏—Ç–∏–∫–∞:\s*–¶–µ–Ω–Ω–æ—Å—Ç–∏ –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è',
            r'–£–∫—Ä–∞–∏–Ω–∞:\s*–¶–µ–Ω–Ω–æ—Å—Ç–∏ –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è',
            r'—Ö–æ—Ä–æ—à–∏–µ –Ω–æ–≤–æ—Å—Ç–∏\? –ñ–º–∏!',
            r'–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –æ–±—ã—á–Ω—É—é –ª–µ–Ω—Ç—É\?',
            r'–†–µ–∫–ª–∞–º–∞\.?\s*–†–µ–∫–ª–∞–º–∞\.?',
            r'–ó–∞–±–æ—Ç–∞ –æ —Å–µ–±–µ\s+—Ö–æ—Ä–æ—à–∏–µ –Ω–æ–≤–æ—Å—Ç–∏',
            r'–°—Ä–µ–¥–∞ –æ–±–∏—Ç–∞–Ω–∏—è\s+–ó–∞–±–æ—Ç–∞ –æ —Å–µ–±–µ',
            r'–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è\s+–ò–∑ –∂–∏–∑–Ω–∏\s+–°—Ä–µ–¥–∞ –æ–±–∏—Ç–∞–Ω–∏—è',
            r'–í–Ω–µ—à–Ω–∏–π –≤–∏–¥:\s*–¶–µ–Ω–Ω–æ—Å—Ç–∏:\s*Lenta\.ru',
            r'–¶–µ–Ω–Ω–æ—Å—Ç–∏\s+–í—Å–µ\s+–°—Ç–∏–ª—å\s+–í–Ω–µ—à–Ω–∏–π –≤–∏–¥\s+–Ø–≤–ª–µ–Ω–∏—è\s+–†–æ—Å–∫–æ—à—å\s+–õ–∏—á–Ω–æ—Å—Ç–∏',
            r'–¶–µ–Ω–Ω–æ—Å—Ç–∏\s+–í—Å–µ\s+–°—Ç–∏–ª—å\s+–í–Ω–µ—à–Ω–∏–π –≤–∏–¥',
            r'\d{2}:\d{2},\s*\d{1,2}\s+[–∞-—è]+\s+\d{4}\s+–¶–µ–Ω–Ω–æ—Å—Ç–∏',
            r'–ü—Ä–µ—Å—Ç—É–ø–Ω–∞—è –†–æ—Å—Å–∏—è:\s*–°–∏–ª–æ–≤—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:\s*Lenta\.ru',
            r'–ú–∏—Ä\s+–í—Å–µ\s+–ü–æ–ª–∏—Ç–∏–∫–∞\s+–û–±—â–µ—Å—Ç–≤–æ\s+–ü—Ä–æ–∏—Å—à–µ—Å—Ç–≤–∏—è\s+–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã\s+–ü—Ä–µ—Å—Ç—É–ø–Ω–æ—Å—Ç—å',
            r'–ë—ã–≤—à–∏–π –°–°–°–†\s+–í—Å–µ\s+–ü—Ä–∏–±–∞–ª—Ç–∏–∫–∞\s+–£–∫—Ä–∞–∏–Ω–∞\s+–ë–µ–ª–æ—Ä—É—Å—Å–∏—è\s+–ú–æ–ª–¥–∞–≤–∏—è\s+–ó–∞–∫–∞–≤–∫–∞–∑—å–µ\s+–°—Ä–µ–¥–Ω—è—è –ê–∑–∏—è',
            r'\d{2}:\d{2},\s*\d{1,2}\s+[–∞-—è]+\s+\d{4}\s+(–ú–∏—Ä|–ë—ã–≤—à–∏–π –°–°–°–†)',
            # VK –í–∏–¥–µ–æ —Ä–µ–∫–ª–∞–º–∞
            r'\d+\+\.\s*–û–û–û\s*[¬´"]–ï–¥–∏–Ω–æ–µ –í–∏–¥–µ–æ[¬ª"]',
            r'VK\s+–í–∏–¥–µ–æ:\s*vkvideo\.ru',
            r'–°–æ–≥–ª–∞—à–µ–Ω–∏–µ:\s*vkvideo\.ru/legal',
            r'VK\s*-\s*–í–ö',
            r'erid:\s*[a-zA-Z0-9]+',
            # –ù–∞–≤–∏–≥–∞—Ü–∏—è —Ä—É–±—Ä–∏–∫
            r'–†–æ—Å—Å–∏—è\s+–í—Å–µ\s+–û–±—â–µ—Å—Ç–≤–æ\s+–ü–æ–ª–∏—Ç–∏–∫–∞\s+–ü—Ä–æ–∏—Å—à–µ—Å—Ç–≤–∏—è\s+–†–µ–≥–∏–æ–Ω—ã',
            r'–ú–æ—Å–∫–≤–∞\s+69-—è –ø–∞—Ä–∞–ª–ª–µ–ª—å\s+–ú–æ—è —Å—Ç—Ä–∞–Ω–∞',
            r'–û–±—â–µ—Å—Ç–≤–æ\s+–ü–æ–ª–∏—Ç–∏–∫–∞\s+–ü—Ä–æ–∏—Å—à–µ—Å—Ç–≤–∏—è',
            # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ—Ä–∞
            r'\([^)]*—Ä–µ–¥–∞–∫—Ç–æ—Ä[^)]*\)',
            r'\([^)]*–∫–æ—Ä—Ä–µ—Å–ø–æ–Ω–¥–µ–Ω—Ç[^)]*\)',
            r'\([^)]*–∂—É—Ä–Ω–∞–ª–∏—Å—Ç[^)]*\)',
            # –§–æ—Ç–æ –∫—Ä–µ–¥–∏—Ç—ã
            r'–§–æ—Ç–æ:\s*[A-Za-z\s]+/\s*Reuters',
            r'–§–æ—Ç–æ:\s*[A-Za-z\s]+/\s*–¢–ê–°–°',
            r'–§–æ—Ç–æ:\s*[A-Za-z\s]+/\s*–†–ò–ê –ù–æ–≤–æ—Å—Ç–∏',
            # –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
            r'–ß—Ç–æ –¥—É–º–∞–µ—à—å\?\s*–û—Ü–µ–Ω–∏!\s*–û–±—Å—É–¥–∏—Ç—å',
            r'–û—Ü–µ–Ω–∏!\s*–û–±—Å—É–¥–∏—Ç—å',
            r'–ù–∞—à–ª–∏ –æ–ø–µ—á–∞—Ç–∫—É\?\s*–ù–∞–∂–º–∏—Ç–µ\s*Ctrl\+Enter',
            # –ë–ª–æ–∫ "–ü–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏"
            r'–ü–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏\s+[–ê-–Ø–∞-—è0-9\s:,‚Äì‚Äî]+\d{2}:\d{2}',
            r'–í—Å–µ –Ω–æ–≤–æ—Å—Ç–∏\s+–†–µ–¥–∞–∫—Ü–∏—è\s+–†–µ–∫–ª–∞–º–∞',
            # –§—É—Ç–µ—Ä Lenta.ru
            r'–†–µ–¥–∞–∫—Ü–∏—è\s+–†–µ–∫–ª–∞–º–∞\s+–ö–æ–Ω—Ç–∞–∫—Ç—ã\s+–ü—Ä–µ—Å—Å-—Ä–µ–ª–∏–∑—ã',
            r'–¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞\s+–°–ø–µ—Ü–ø—Ä–æ–µ–∫—Ç—ã\s+–í–∞–∫–∞–Ω—Å–∏–∏\s+RSS',
            r'–ü—Ä–∞–≤–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\s+–ú–∏–Ω–∏-–∏–≥—Ä—ã',
            r'‚Äì\d{4}\s+–û–û–û\s*[¬´"]–õ–µ–Ω—Ç–∞\.–†—É[¬ª"]',
            r'¬©\s*\d{4}\s+–û–û–û\s*[¬´"]–õ–µ–Ω—Ç–∞\.–†—É[¬ª"]',
            # "–õ–µ–Ω—Ç–∞ –¥–æ–±—Ä–∞" —ç–ª–µ–º–µ–Ω—Ç
            r'\d+\+\s*–õ–µ–Ω—Ç–∞ –¥–æ–±—Ä–∞ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞',
            r'–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Ä–µ–∞–ª—å–Ω—ã–π –º–∏—Ä',
            r'–õ–µ–Ω—Ç–∞ –¥–æ–±—Ä–∞ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞',
            # Cookie notice
            r'–ù–∞ —Å–∞–π—Ç–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è cookies',
            r'–ü—Ä–æ–¥–æ–ª–∂–∞—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∞–π—Ç',
            r'–≤—ã –ø—Ä–∏–Ω–∏–º–∞–µ—Ç–µ —É—Å–ª–æ–≤–∏—è\s*Ok',
            # –ù–æ–≤—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
            r'–ù–æ–≤—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã\s+–í—Å–µ –Ω–æ–≤–æ—Å—Ç–∏',
            # –†–∞–Ω–µ–µ —Å–æ–æ–±—â–∞–ª–æ—Å—å (—Å—Å—ã–ª–∫–∏)
            r'–†–∞–Ω–µ–µ —Å–æ–æ–±—â–∞–ª–æ—Å—å\s*,\s*—á—Ç–æ',
            # –û–±—â–µ–µ –º–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ —Å–∞–π—Ç–æ–≤
            r'–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å: –≠–∫–æ–Ω–æ–º–∏–∫–∞: Lenta\.ru',
            r'(–ì–ª–∞–≤–Ω–æ–µ|–†–æ—Å—Å–∏—è|–ú–∏—Ä|–ë—ã–≤—à–∏–π –°–°–°–†|–≠–∫–æ–Ω–æ–º–∏–∫–∞|–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å):\s*(–≠–∫–æ–Ω–æ–º–∏–∫–∞|Lenta\.ru|–ì–ª–∞–≤–Ω–æ–µ)',
            r'–í–æ–π—Ç–∏\s+–≠–∫—Å–∫–ª—é–∑–∏–≤—ã\s+–°—Ç–∞—Ç—å–∏',
            r'–ì–∞–ª–µ—Ä–µ–∏\s+–í–∏–¥–µ–æ\s+–°–ø–µ—Ü–ø—Ä–æ–µ–∫—Ç—ã',
            # 360.ru –Ω–∞–≤–∏–≥–∞—Ü–∏—è
            r'–í—Å–µ –Ω–æ–≤–æ—Å—Ç–∏ –ò—Å—Ç–æ—Ä–∏–∏ –≠—Ñ–∏—Ä –°—É–ø–µ—Ä—á–∞—Ç 360 –°–ø–µ—Ü–ø—Ä–æ–µ–∫—Ç—ã',
            r'–ü–æ–¥–º–æ—Å–∫–æ–≤—å–µ –ë–∞–ª–∞—à–∏—Ö–∞ –ë–æ–≥–æ—Ä–æ–¥—Å–∫–∏–π –í–æ—Å–∫—Ä–µ—Å–µ–Ω—Å–∫ –î–º–∏—Ç—Ä–æ–≤ –ò—Å—Ç—Ä–∞ –ö–æ—Ç–µ–ª—å–Ω–∏–∫–∏',
            r'–ö—Ä–∞—Å–Ω–æ–≥–æ—Ä—Å–∫ –õ–æ–±–Ω—è –ú—ã—Ç–∏—â–∏ –ù–∞—Ä–æ-–§–æ–º–∏–Ω—Å–∫–∏–π –û–¥–∏–Ω—Ü–æ–≤–æ –ü–∞–≤–ª–æ–≤—Å–∫–∏–π –ü–æ—Å–∞–¥',
            r'–ü–æ–¥–æ–ª—å—Å–∫ –ü—É—à–∫–∏–Ω—Å–∫–∏–π –°–æ–ª–Ω–µ—á–Ω–æ–≥–æ—Ä—Å–∫ –•–∏–º–∫–∏ –ß–µ—Ö–æ–≤ –ö–æ—Ä–æ–ª–µ–≤ –†–µ—É—Ç–æ–≤ –ö–æ–ª–æ–º–Ω–∞ –†–∞–º–µ–Ω—Å–∫–∏–π',
            r'\|\s*360\.ru\s*–í—Å–µ –Ω–æ–≤–æ—Å—Ç–∏',
            r'–°—É–ø–µ—Ä—á–∞—Ç 360\s+–°–ø–µ—Ü–ø—Ä–æ–µ–∫—Ç—ã\s+–ü–æ–¥–º–æ—Å–∫–æ–≤—å–µ',
            # RIAMO –Ω–∞–≤–∏–≥–∞—Ü–∏—è
            r'–ù–æ–≤–æ—Å—Ç–∏ –ü–æ–¥–º–æ—Å–∫–æ–≤—å—è, —Å–æ–±—ã—Ç–∏—è –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ \| –†–ò–ê–ú–û',
            r'–ì–∏–±–µ–ª—å –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ –∏–Ω—Ç–µ—Ä–Ω–∞—Ç–∞ –≤ –ö—É–∑–±–∞—Å—Å–µ –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –≤–æ–µ–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è',
            r'–ê—Ç–∞–∫–∞ –°–®–ê –Ω–∞ –í–µ–Ω–µ—Å—É—ç–ª—É –í—Å–µ —Ç–µ–º—ã',
            r'–°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –≤–æ–µ–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –Ω–∞ –£–∫—Ä–∞–∏–Ω–µ',
            r'\|\s*–†–ò–ê–ú–û\s*–ì–∏–±–µ–ª—å',
            # mosregtoday.ru –Ω–∞–≤–∏–≥–∞—Ü–∏—è
            r'–°–≤–µ–∂–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è \| –ü–æ–¥–º–æ—Å–∫–æ–≤—å–µ –°–µ–≥–æ–¥–Ω—è',
            r'–ù–æ–≤–æ—Å—Ç–∏ –ß—Ç–∏–≤–æ –≠–∫—Å–∫–ª—é–∑–∏–≤—ã –í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥ –ø–æ–∏—Å–∫',
            r'–ß—É–º–∞ XXI –≤–µ–∫–∞\? –ù–æ–≤—ã–π —Å–ª—É—á–∞–π –æ—Å–ø—ã –æ–±–µ–∑—å—è–Ω –≤–∑–±—É–¥–æ—Ä–∞–∂–∏–ª',
            r'–û—Ç –∑–Ω–∞–∫–∞ –Ω–∞ —Ç—Ä–∞—Å—Å–µ –¥–æ –º–∏—Ä–æ–≤–æ–π –∏—Å—Ç–æ—Ä–∏–∏',
            r'–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥ –ø–æ–∏—Å–∫ –ù–æ–≤–æ—Å—Ç–∏ –û–±—â–µ—Å—Ç–≤–æ',
            r'–ê–∫—Ç—É–∞–ª—å–Ω–æ –ë–µ—Å–ø–∏–ª–æ—Ç–Ω–∏–∫ –ø–æ –∂–∏–ª—ã–º',
            r'–ù–∞ —á—Ç–æ –ø—Ä–æ–º–µ–Ω—è–ª–∏ –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—É—é –ø—Ä–æ—Å—Ç–æ—Ç—É',
            r'–ú–∞—Ç–∫–∞–ø–∏—Ç–∞–ª –≤–∑–ª–µ—Ç–∏—Ç –¥–æ –Ω–µ–±–µ—Å',
            r'–ü–µ–Ω—Å–∏–æ–Ω–µ—Ä–∫–∞ –ø—Ä–æ–¥–∞–ª–∞ –¥–≤–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã',
            r'–ó–∞—â–∏—Ç–∞ —Å–Ω—è—Ç–∞: —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç',
            r'–¢–∞–π–Ω—ã–π —Å–ø–∏—Å–æ–∫ –±–æ–≥–∞—á–µ–π',
            r'–†–æ—Å–ø–æ—Ç—Ä–µ–±–Ω–∞–¥–∑–æ—Ä –∏ –≤—Ä–∞—á–µ–π –†–æ—Å—Å–∏–∏',
            r'–ë–µ—Å–ø–∏–ª–æ—Ç–Ω–∏–∫ –ø–æ –∂–∏–ª—ã–º –¥–æ–º–∞–º',
            r'–†–æ–¥–∏—Ç–µ–ª–∏ –Ω–µ –ø—É—Å—Ç–∏–ª–∏ ‚Äî –∏ —Å–ø–∞—Å–ª–∏ –∂–∏–∑–Ω—å',
            r'–ê–Ω–Ω—É—à–∫–∞ —É–∂–µ —Ä–∞–∑–ª–∏–ª–∞ –º–∞—Å–ª–æ',
            r'–£–∫—Ä–∞–∏–Ω–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–µ–¥–º–µ—Ç–Ω–æ–º—É —Ä–∞–∑–≥–æ–≤–æ—Ä—É',
            r'–ó–≤–æ–Ω–æ–∫ –≤ –ø–∞–º—è—Ç—å –æ –ø–µ—Ä–≤–æ–º –ø—Ä–µ–∑–∏–¥–µ–Ω—Ç–µ',
            r'–ü—Ä–∞–∑–¥–Ω–∏–∫ –¥–ª–∏–Ω–æ–π –≤ –∫–∏–ª–æ–º–µ—Ç—Ä',
            r'–ü–æ—è–≤–∏–ª–∏—Å—å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –∂–∏–∑–Ω–∏ —É–º–µ—Ä—à–µ–π',
            r'–í–ª–∞–¥–µ–ª—å—Ü—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã',
            # –û–±—â–∏–µ —à–∞–±–ª–æ–Ω—ã –¥–ª—è –≤—Å–µ—Ö –Ω–æ–≤–æ—Å—Ç–Ω—ã—Ö —Å–∞–π—Ç–æ–≤
            r'\d{2}\s+(—è–Ω–≤–∞—Ä—è|—Ñ–µ–≤—Ä–∞–ª—è|–º–∞—Ä—Ç–∞|–∞–ø—Ä–µ–ª—è|–º–∞—è|–∏—é–Ω—è|–∏—é–ª—è|–∞–≤–≥—É—Å—Ç–∞|—Å–µ–Ω—Ç—è–±—Ä—è|–æ–∫—Ç—è–±—Ä—è|–Ω–æ—è–±—Ä—è|–¥–µ–∫–∞–±—Ä—è)\s+\d{4},\s+\d{2}:\d{2}\s+–ê–∫—Ç—É–∞–ª—å–Ω–æ',
            r'—Å–µ–≥–æ–¥–Ω—è –≤ \d{2}:\d{2}\s+(–ó–¥—Ä–∞–≤–æ–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ|–û–±—â–µ—Å—Ç–≤–æ|–≠–∫–æ–Ω–æ–º–∏–∫–∞)',
            r'–í—Å–µ —Ç–µ–º—ã\s+—Å–µ–≥–æ–¥–Ω—è –≤ \d{2}:\d{2}',
            # –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ –∏ —Å—á—ë—Ç—á–∏–∫–∏
            r'–°–µ–≥–æ–¥–Ω—è \d{2}:\d{2}',
            r'\d{2}\s+(—è–Ω–≤–∞—Ä—è|—Ñ–µ–≤—Ä–∞–ª—è|–º–∞—Ä—Ç–∞|–∞–ø—Ä–µ–ª—è|–º–∞—è|–∏—é–Ω—è|–∏—é–ª—è|–∞–≤–≥—É—Å—Ç–∞|—Å–µ–Ω—Ç—è–±—Ä—è|–æ–∫—Ç—è–±—Ä—è|–Ω–æ—è–±—Ä—è|–¥–µ–∫–∞–±—Ä—è)\s+\d{4},\s+\d{2}:\d{2}\s+(–û–±—â–µ—Å—Ç–≤–æ|–≠–∫–æ–Ω–æ–º–∏–∫–∞|–ó–¥—Ä–∞–≤–æ–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ|–ê–∫—Ç—É–∞–ª—å–Ω–æ)',
            r'\s+0\s+0\s+0\s+',  # –°—á—ë—Ç—á–∏–∫–∏ –ª–∞–π–∫–æ–≤/–ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
            r'\s+\d+\s+\d+\s+\d+\s+–§–æ—Ç–æ:',
            # –§–æ—Ç–æ –∏ –ø—Ä–µ—Å—Å-—Å–ª—É–∂–±—ã
            r'–§–æ—Ç–æ:\s*–ü—Ä–µ—Å—Å-—Å–ª—É–∂–±–∞',
            r'–§–æ—Ç–æ:\s*[–ê-–Ø–∞-—è\s-]+–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏',
            r'–ü—Ä–µ—Å—Å-—Å–ª—É–∂–±–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏',
            r'–°–í–ò–î–ï–¢–ï–õ–¨–°–¢–í–û –û –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò –°–ú–ò',
            r'–ü–†–ê–í–ê –ù–ê –í–°–ï –ú–ê–¢–ï–†–ò–ê–õ–´',
            r'–ò–ó–î–ê–¢–ï–õ–¨–°–ö–ò–ô –î–û–ú "–ü–û–î–ú–û–°–ö–û–í–¨–ï"',
            r'–ù–æ–≤–æ—Å—Ç–∏ –û —Ä–µ–¥–∞–∫—Ü–∏–∏ –°—Ç–∞—Ç—å–∏ –†–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª—è–º –°–ø–µ—Ü–ø—Ä–æ–µ–∫—Ç—ã –ì–∞–∑–µ—Ç—ã –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è',
            r'–ü–æ–ª–∏—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ –∑–∞—â–∏—Ç—ã –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö',
            r'Materialy dostupny po licenzii',
            # –û–±—Ä—ã–≤–∫–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –≤ –∫–æ–Ω—Ü–µ
            r'[–∞-—è]+:\s*[–∞-—è\s]+$',  # "–¥–æ–º–∞–º: —É–¥–∞—Ä –≤ –°–∞—Ä—Ç–∞–Ω–µ"
            # TASS (–¢–ê–°–°) –º—É—Å–æ—Ä
            r'–¢–ê–°–°\s*-\s*–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ –∞–≥–µ–Ω—Ç—Å—Ç–≤–æ',
            r'–¢–ê–°–°\s*/\s*[–ê-–Ø\s]+\s*-',
            r'–§–æ—Ç–æ:\s*–¢–ê–°–°',
            r'¬©\s*–¢–ê–°–°',
            r'—Ç–∞—Å—Å\.—Ä—É\s+–í—Å–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã',
            # Gazeta.ru (–ì–∞–∑–µ—Ç–∞.—Ä—É) –º—É—Å–æ—Ä
            r'–ì–∞–∑–µ—Ç–∞\.Ru\s*‚Äî\s*–Ω–æ–≤–æ—Å—Ç–∏',
            r'–ü–æ–¥—Ä–æ–±–Ω–µ–µ –Ω–∞ Gazeta\.Ru',
            r'¬©\s*Gazeta\.Ru',
            r'–§–æ—Ç–æ:\s*[–ê-–Ø–∞-—è\s/]+Gazeta\.Ru',
            # RBC (–†–ë–ö) –º—É—Å–æ—Ä
            r'–†–ë–ö\s*‚Äî\s*–Ω–æ–≤–æ—Å—Ç–∏',
            r'¬©\s*–†–ë–ö',
            r'–§–æ—Ç–æ:\s*–†–ë–ö',
            r'www\.rbc\.ru\s+–ì–ª–∞–≤–Ω–∞—è',
            r'–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –†–ë–ö',
            # Kommersant (–ö–æ–º–º–µ—Ä—Å–∞–Ω—Ç—ä) –º—É—Å–æ—Ä
            r'–ö–æ–º–º–µ—Ä—Å–∞–Ω—Ç—ä\s*‚Äî\s*–∏–∑–¥–∞—Ç–µ–ª—å—Å–∫–∏–π –¥–æ–º',
            r'¬©\s*–ê–û\s*"–ö–æ–º–º–µ—Ä—Å–∞–Ω—Ç—ä"',
            r'–§–æ—Ç–æ:\s*–ö–æ–º–º–µ—Ä—Å–∞–Ω—Ç—ä',
            r'kommersant\.ru\s+–ì–ª–∞–≤–Ω–∞—è',
            # Interfax (–ò–Ω—Ç–µ—Ä—Ñ–∞–∫—Å) –º—É—Å–æ—Ä
            r'–ò–Ω—Ç–µ—Ä—Ñ–∞–∫—Å\s*-\s*–†–æ—Å—Å–∏—è',
            r'¬©\s*–ò–Ω—Ç–µ—Ä—Ñ–∞–∫—Å',
            r'–ü–æ–¥—Ä–æ–±–Ω–µ–µ –Ω–∞ –ò–Ω—Ç–µ—Ä—Ñ–∞–∫—Å',
            r'interfax\.ru\s+–í—Å–µ –Ω–æ–≤–æ—Å—Ç–∏',
            # Dzen (–î–∑–µ–Ω) –º—É—Å–æ—Ä
            r'–Ø–Ω–¥–µ–∫—Å\.–î–∑–µ–Ω\s*‚Äî\s*–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –ª–µ–Ω—Ç–∞',
            r'dzen\.ru\s+–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è',
            r'–ß–∏—Ç–∞—Ç—å –Ω–∞ –î–∑–µ–Ω',
            r'–ï—â—ë –æ—Ç –∞–≤—Ç–æ—Ä–∞',
            # Ren.tv (–†–ï–ù –¢–í) –º—É—Å–æ—Ä
            r'–†–ï–ù\s*–¢–í\s*‚Äî\s*–Ω–æ–≤–æ—Å—Ç–∏',
            r'¬©\s*–†–ï–ù\s*–¢–í',
            r'ren\.tv\s+–ì–ª–∞–≤–Ω–∞—è',
            # Iz.ru (–ò–∑–≤–µ—Å—Ç–∏—è) –º—É—Å–æ—Ä
            r'–ò–∑–≤–µ—Å—Ç–∏—è\s*‚Äî\s*–Ω–æ–≤–æ—Å—Ç–∏',
            r'¬©\s*–ò–∑–≤–µ—Å—Ç–∏—è',
            r'iz\.ru\s+–í—Å–µ –Ω–æ–≤–æ—Å—Ç–∏',
            # RT (Russia Today) –º—É—Å–æ—Ä
            r'RT\s*–Ω–∞\s*—Ä—É—Å—Å–∫–æ–º',
            r'–†–¢\s*–Ω–∞\s*—Ä—É—Å—Å–∫–æ–º',
            r'¬©\s*RT',
            r'¬©\s*–†–¢',
            r'russian\.rt\.com\s+–ì–ª–∞–≤–Ω–∞—è',
            r'–ö–∞–Ω–∞–ª RT –Ω–∞ Telegram\.me',
            r'–í–∫–æ–Ω—Ç–∞–∫—Ç–µ\s+Twitter\s+RT Russian',
            r'–ö–∞–Ω–∞–ª RT –Ω–∞ Max\.ru',
            r'–≤ rutube –≥—Ä—É–ø–ø–∞ –Ω–∞ –û–¥–Ω–æ–∫–ª–∞—Å—Å–Ω–∏–∫–∏\.ru',
            r'–≤ –î–∑–µ–Ω rss –≤ TikTok',
            r'ENG\s+DE\s+FR\s+ÿßŸÑÿπÿ±ÿ®Ÿäÿ©\s+ESP\s+RS\s+RT–î\s+Search\s+Menu\s+mobile',
            r'–ë–†–ò–ö–°\s+–í–Ω–µ—à–Ω—è—è –ø–æ–ª–∏—Ç–∏–∫–∞\s+–ï–≤—Ä–æ–ø–∞\s+–ê—Ñ—Ä–∏–∫–∞\s+–ë–ª–∏–∂–Ω–∏–π –í–æ—Å—Ç–æ–∫\s+–ü–∞–ª–µ—Å—Ç–∏–Ω–æ-–∏–∑—Ä–∞–∏–ª—å—Å–∫–∏–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç\s+–ê–∑–∏—è\s+–°–∞–Ω–∫—Ü–∏–∏\s+–ò–Ω–æ–¢–í\s+–í—ã–±–æ—Ä—ã –≤ –°–®–ê\s+‚Äî\s+\d{4}',
            r'Search Menu mobile',
            r'–ù–æ–≤–æ—Å—Ç–∏\s+–ú–∏—Ä\s+–†–æ—Å—Å–∏—è\s+–ë—ã–≤—à–∏–π –°–°–°–†\s+–≠–∫–æ–Ω–æ–º–∏–∫–∞\s+–°–ø–æ—Ä—Ç\s+–ù–∞—É–∫–∞\s+–ë–µ–∑ –ø–æ–ª–∏—Ç–∏–∫–∏',
            r'–ú–Ω–µ–Ω–∏—è\s+–ò–Ω–æ–¢–í\s+–§–æ—Ç–æ\s+–í–∏–¥–µ–æ',
            r'–°–ø–µ—Ü–æ–ø–µ—Ä–∞—Ü–∏—è –Ω–∞ –£–∫—Ä–∞–∏–Ω–µ',
            r'–í–æ–µ–Ω–Ω—ã–µ –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏—è –Ω–∞ –£–∫—Ä–∞–∏–Ω–µ',
            r'–ö–∞—Ä—Ç–∞ –ø–æ–º–æ—â–∏ –£–∫—Ä–∞–∏–Ω–∞',
            r'–ë–µ–ª–æ—Ä—É—Å—Å–∏—è\s+–ú–æ–ª–¥–∞–≤–∏—è\s+–ü—Ä–∏–±–∞–ª—Ç–∏–∫–∞\s+–ó–∞–∫–∞–≤–∫–∞–∑—å–µ',
            r'–ö–æ—Ä–æ—Ç–∫–∞—è —Å—Å—ã–ª–∫–∞',
            r'–û—à–∏–±–∫–∞ –≤ —Ç–µ–∫—Å—Ç–µ\?\s*–í—ã–¥–µ–ª–∏—Ç–µ –µ—ë –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´Ctrl \+ Enter¬ª',
            r'–°–µ–≥–æ–¥–Ω—è –≤ –°–ú–ò',
            r'–õ–µ–Ω—Ç–∞ –Ω–æ–≤–æ—Å—Ç–µ–π',
            r'–ö–∞—Ä—Ç–∏–Ω–∞ –¥–Ω—è\s+\d{2}:\d{2}',
            r'–ù–æ–≤–æ—Å—Ç–∏ –°–ú–ò2',
            r'English\s+Deutsch\s+Fran√ßais\s+ÿßŸÑÿπÿ±ÿ®Ÿäÿ©\s+Espa√±ol\s+–°—Ä–ø—Å–∫–∏\s+RT–î',
            r'RUPTLY',
            r'–û–∫–Ω–æ –≤ –†–æ—Å—Å–∏—é',
            r'–®–∫–æ–ª–∞ RT',
            r'–ü—Ä–µ—Å—Å-—Ä–µ–ª–∏–∑—ã\s+–û –∫–∞–Ω–∞–ª–µ\s+–ü—Ä–æ–º–æ RT: –ò–∑–±—Ä–∞–Ω–Ω–æ–µ',
            r'–ü—Ä–æ–≥—Ä–∞–º–º—ã RT\s+–ö–æ–Ω—Ç–∞–∫—Ç—ã\s+–¢–µ–∫—É—â–∏–µ –∑–∞–∫—É–ø–∫–∏ RT',
            r'–ù–∞–ø–∏—Å–∞—Ç—å –≤ —Ä–µ–¥–∞–∫—Ü–∏—é\s+–ù–æ–≤–æ—Å—Ç–∏ –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤',
            r'–°–∏—Å—Ç–µ–º—ã —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π',
            r'18\+\s*RT',
            r'¬©\s*–ê–≤—Ç–æ–Ω–æ–º–Ω–∞—è –Ω–µ–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è ¬´–¢–í-–ù–æ–≤–æ—Å—Ç–∏¬ª',
            r'–°–µ—Ç–µ–≤–æ–µ –∏–∑–¥–∞–Ω–∏–µ rt\.com –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ',
            r'–ì–ª–∞–≤–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä:',
            r'–ê–¥—Ä–µ—Å —Ä–µ–¥–∞–∫—Ü–∏–∏:',
            r'–¢–µ–ª–µ—Ñ–æ–Ω: \+7\s*\d{3}\s*\d{3}-\d{2}-\d{2}',
            r'(?s:–≤ –î–∑–µ–Ω\s+–í –º–∏—Ä–µ.*?—Ñ–∞–π–ª—ã cookies\s+–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å)',
            # –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ –±–ª–æ–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏/–ª–∏—Å—Ç–∏–Ω–≥–∏
            r'(?s:–ü–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏.*?–í—Å–µ –Ω–æ–≤–æ—Å—Ç–∏)',
            r'(?s:–õ–µ–Ω—Ç–∞ –Ω–æ–≤–æ—Å—Ç–µ–π.*?–í—Å–µ –Ω–æ–≤–æ—Å—Ç–∏)',
            r'(?s:–ö–∞—Ä—Ç–∏–Ω–∞ –¥–Ω—è.*?–í—Å–µ –Ω–æ–≤–æ—Å—Ç–∏)',
            r'(?s:–ù–æ–≤–æ—Å—Ç–∏ –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤.*?–í—Å–µ –Ω–æ–≤–æ—Å—Ç–∏)',
            r'(?s:–ù–æ–≤–æ—Å—Ç–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤.*?–í—Å–µ –Ω–æ–≤–æ—Å—Ç–∏)',
            r'(?s:–ú–∞—Ç–µ—Ä–∏–∞–ª—ã –ø–æ —Ç–µ–º–µ.*?–í—Å–µ –Ω–æ–≤–æ—Å—Ç–∏)',
            r'(?s:–ß–∏—Ç–∞–π—Ç–µ —Ç–∞–∫–∂–µ.*?–í—Å–µ –Ω–æ–≤–æ—Å—Ç–∏)',
            r'(?s:–°–º–æ—Ç—Ä–∏—Ç–µ —Ç–∞–∫–∂–µ.*?–í—Å–µ –Ω–æ–≤–æ—Å—Ç–∏)',
            r'(?s:–ü–æ—Ö–æ–∂–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã.*?–í—Å–µ –Ω–æ–≤–æ—Å—Ç–∏)',
            # –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ —Å–æ—Ü—Å–µ—Ç–∏/–Ω–∞–≤–∏–≥–∞—Ü–∏—è
            r'–í–∫–æ–Ω—Ç–∞–∫—Ç–µ\s+Twitter\s+Facebook\s+Instagram',
            r'–í–ö–æ–Ω—Ç–∞–∫—Ç–µ\s+Twitter\s+Facebook\s+Instagram',
            r'–í–ö–æ–Ω—Ç–∞–∫—Ç–µ\s+–û–¥–Ω–æ–∫–ª–∞—Å—Å–Ω–∏–∫–∏\s+Telegram\s+YouTube',
            r'YouTube\s+Telegram\s+–î–∑–µ–Ω\s+TikTok',
            r'RSS\s+Search\s+Menu',
            r'–ü–æ–∏—Å–∫\s+–ú–µ–Ω—é',
            # regions.ru –º—É—Å–æ—Ä
            r'Regions\.ru\s*‚Äî\s*–Ω–æ–≤–æ—Å—Ç–∏ —Ä–µ–≥–∏–æ–Ω–æ–≤',
            r'¬©\s*Regions\.ru',
            # –û–±—â–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –≤—Å–µ—Ö —Å–∞–π—Ç–æ–≤
            r'¬©\s*\d{4}',  # Copyright —Å –≥–æ–¥–æ–º
            r'–í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã',
            r'–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤',
            r'–ü—Ä–∏ —Ü–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏',
            r'–†–µ–¥–∞–∫—Ü–∏—è –Ω–µ –Ω–µ—Å–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏',
            r'–ú–Ω–µ–Ω–∏–µ —Ä–µ–¥–∞–∫—Ü–∏–∏',
            r'–º–æ–∂–µ—Ç –Ω–µ —Å–æ–≤–ø–∞–¥–∞—Ç—å',
            r'–ü–æ–¥–ø–∏—Å—ã–≤–∞–π—Ç–µ—Å—å –Ω–∞ –Ω–∞—à –∫–∞–Ω–∞–ª',
            r'–°–ª–µ–¥–∏—Ç–µ –∑–∞ –Ω–æ–≤–æ—Å—Ç—è–º–∏',
            r'–ë–æ–ª—å—à–µ –Ω–æ–≤–æ—Å—Ç–µ–π –Ω–∞',
            r'–ß–∏—Ç–∞–π—Ç–µ —Ç–∞–∫–∂–µ:',
            r'–°–º–æ—Ç—Ä–∏—Ç–µ —Ç–∞–∫–∂–µ:',
            r'–†–∞–Ω–µ–µ —Å–æ–æ–±—â–∞–ª–æ—Å—å:',
            # –§–æ—Ä–º—ã –ø–æ–¥–ø–∏—Å–∫–∏ –∏ —Å–æ—Ü—Å–µ—Ç–∏
            r'–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Ä–∞—Å—Å—ã–ª–∫—É',
            r'–í–≤–µ–¥–∏—Ç–µ –≤–∞—à e-mail',
            r'–°–ª–µ–¥–∏—Ç–µ –∑–∞ –Ω–∞–º–∏ –≤',
            r'Facebook\s*Instagram\s*Twitter',
            r'–í–ö–æ–Ω—Ç–∞–∫—Ç–µ\s*–û–¥–Ω–æ–∫–ª–∞—Å—Å–Ω–∏–∫–∏\s*Telegram',
            # –ù–∞–≤–∏–≥–∞—Ü–∏—è –∏ —Ñ—É—Ç–µ—Ä—ã
            r'–û –ø—Ä–æ–µ–∫—Ç–µ\s*–ö–æ–Ω—Ç–∞–∫—Ç—ã\s*–†–µ–∫–ª–∞–º–∞',
            r'–†–µ–¥–∞–∫—Ü–∏—è\s*–ê–≤—Ç–æ—Ä—ã\s*RSS',
            r'–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ',
            r'–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏',
        ]
        for pattern in junk_patterns:
            text = re.sub(pattern, '', text, flags=re.IGNORECASE)
        
        # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å—Ç—Ä–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏/—Å–ª—É–∂–µ–±–Ω—ã—Ö –±–ª–æ–∫–æ–≤
        text = _filter_navigation_lines(text)

        # –û—á–∏—â–∞–µ–º –æ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–µ–ª–æ–≤ –∏ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ —Å—Ç—Ä–æ–∫
        text = re.sub(r'\s+', ' ', text)  # –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã ‚Üí –æ–¥–∏–Ω
        
        # –£–¥–∞–ª—è–µ–º –∫–æ—Å—ã–µ —á–µ—Ä—Ç—ã –∏ –æ–±—Ä–∞—Ç–Ω—ã–µ —Å–ª–µ—à–∏
        text = text.replace('/', ' ').replace('\\', ' ')
        
        text = text.strip()
        
        return text
    except Exception as e:
        logger.error(f"Error cleaning HTML: {e}")
        return html_text


def _filter_navigation_lines(text: str) -> str:
    """–£–¥–∞–ª—è–µ—Ç —Å—Ç—Ä–æ–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏, —Ñ—É—Ç–µ—Ä–æ–≤ –∏ —Å–æ—Ü–±–ª–æ–∫–æ–≤ –ø–æ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–º –ø—Ä–∞–≤–∏–ª–∞–º"""
    lines = text.splitlines()
    filtered = []
    for raw_line in lines:
        line = raw_line.strip()
        if not line:
            continue
        lower = line.lower()

        # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Ç—Ä–æ–∫–∏ —Å —è–≤–Ω—ã–º–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏
        if any(pattern.search(lower) for pattern in NAVIGATION_PATTERNS):
            continue
        if any(domain in lower for domain in SOCIAL_DOMAINS):
            continue

        tokens = re.findall(r'[–∞-—èa-z0-9]+', lower)
        if tokens:
            nav_matches = sum(1 for token in tokens if token in NAVIGATION_KEYWORDS)
            if nav_matches >= max(3, int(len(tokens) * 0.7)):
                continue

        filtered.append(line)

    return '\n'.join(filtered)


def extract_first_paragraph(text: str, min_length: int = 30, max_length: int = 250) -> str:
    """
    –ò–∑–≤–ª–µ–∫–∞–µ—Ç –ø–µ—Ä–≤—ã–π –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã–π –∞–±–∑–∞—Ü –±–µ–∑ –º—É—Å–æ—Ä–∞.
    –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç –æ–±—Ä—ã–≤–∫–∏, —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã —Å –¥–≤–æ–µ—Ç–æ—á–∏—è–º–∏, –∫–æ—Ä–æ—Ç–∫–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è.
    
    Args:
        text: –∏—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç
        min_length: –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è (–æ–±—ã—á–Ω–æ = 20 –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –º—É—Å–æ—Ä–∞)
        max_length: –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ —Å–∏–º–≤–æ–ª–∞—Ö
    """
    if not text:
        return ""
    
    # –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã
    text = text.strip()
    
    # –£–±–∏—Ä–∞–µ–º –Ω–µ–ø–æ–ª–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –≤ –∫–æ–Ω—Ü–µ (–æ–±—Ä—ã–≤–∫–∏ –≤—Ä–æ–¥–µ "–¥–æ–º–∞–º: —É–¥–∞—Ä –≤ –°–∞—Ä—Ç–∞–Ω–µ")
    text = re.sub(r'\s*[–∞-—è–ê-–Ø]+:\s*[–∞-—è–ê-–Ø\s\-–∞-—è–ê-–Ø]*$', '', text)
    
    # –£–±–∏—Ä–∞–µ–º —Å–ª—É–∂–µ–±–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã —Ç–∏–ø–∞ "–§–æ—Ç–æ:", "–ò—Å—Ç–æ—á–Ω–∏–∫:", "–°–º–æ—Ç—Ä–∏—Ç–µ —Ç–∞–∫–∂–µ:"
    text = re.sub(r'(–§–æ—Ç–æ|–ò—Å—Ç–æ—á–Ω–∏–∫|–°–º–æ—Ç—Ä–∏—Ç–µ —Ç–∞–∫–∂–µ|–ß–∏—Ç–∞–π—Ç–µ —Ç–∞–∫–∂–µ|–†–∞–Ω–µ–µ —Å–æ–æ–±—â–∞–ª–æ—Å—å|–ü–æ–¥—Ä–æ–±–Ω–µ–µ):\s*.*$', '', text, flags=re.IGNORECASE)
    
    # –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —Ç–æ—á–∫–µ, –≤–æ–ø—Ä–æ—Å—É, –≤–æ—Å–∫–ª–∏—Ü–∞–Ω–∏—é
    sentences = re.split(r'[.!?]+', text)
    sentences = [s.strip() for s in sentences if s.strip()]
    
    # –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, –ø—Ä–æ–ø—É—Å–∫–∞—è –º—É—Å–æ—Ä
    result = []
    current_length = 0
    
    for sentence in sentences:
        if not sentence:
            continue
        
        # –§–∏–ª—å—Ç—Ä—ã –º—É—Å–æ—Ä–∞:
        # 1. –°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã (–æ–±—ã—á–Ω–æ –æ—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞)
        if len(sentence) < 20:
            continue
        
        # 2. –¢–æ–ª—å–∫–æ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞ –∏–ª–∏ —á–∏—Å–ª–∞
        word_tokens = re.findall(r'[–∞-—è–ê-–Øa-zA-Z]+', sentence)
        if len(word_tokens) < 5:  # –ú–∏–Ω–∏–º—É–º 5 —Å–ª–æ–≤ –≤ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏
            continue
        
        # 3. –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è —Å –≤—ã—Å–æ–∫–∏–º –ø—Ä–æ—Ü–µ–Ω—Ç–æ–º —Ü–∏—Ñ—Ä (–æ–±—ã—á–Ω–æ —ç—Ç–æ –º—É—Å–æ—Ä —Ç–∏–ø–∞ "22326")
        digit_ratio = len(re.findall(r'\d+', sentence)) / max(1, len(word_tokens))
        if digit_ratio > 0.3:
            continue
        
        # 4. –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—â–∏–µ—Å—è –Ω–∞ –¥–≤–æ–µ—Ç–æ—á–∏–µ (—Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã)
        if sentence.rstrip().endswith(':'):
            continue
        
        # 5. –û—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è (–æ–±—ã—á–Ω–æ –æ—à–∏–±–∫–∏ HTML –ø–∞—Ä—Å–∏–Ω–≥–∞)
        if len(sentence) > 500:
            continue
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏ –ª–∏–º–∏—Ç
        if current_length + len(sentence) > max_length:
            break
        
        result.append(sentence)
        current_length += len(sentence) + 1
    
    # –§–æ—Ä–º–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    if result:
        paragraph = '. '.join(result) + '.'
        # –û–±—Ä–µ–∑–∞–µ–º –µ—Å–ª–∏ –≤—Å—ë –µ—â—ë –ø—Ä–µ–≤—ã—à–∞–µ—Ç max_length
        if len(paragraph) > max_length:
            return truncate_text(paragraph, max_length)
        return paragraph
    
    # Fallback: –±–µ—Ä—ë–º –ø–µ—Ä–≤—ã–µ max_length —Å–∏–º–≤–æ–ª–æ–≤
    return truncate_text(text, max_length)


def truncate_text(text: str, max_length: int = 500) -> str:
    """
    –û–±—Ä–µ–∑–∞–µ—Ç —Ç–µ–∫—Å—Ç –¥–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –¥–ª–∏–Ω—ã
    """
    if len(text) <= max_length:
        return text
    
    # –û–±—Ä–µ–∑–∞–µ–º –ø–æ —Å–ª–æ–≤—É
    truncated = text[:max_length]
    last_space = truncated.rfind(' ')
    if last_space > 0:
        truncated = truncated[:last_space]
    
    return truncated + '...'


def truncate_for_telegram(text: str, max_length: int = 1000) -> str:
    """
    Hard limit for telegram message (1000 chars)
    """
    if len(text) <= max_length:
        return text
    
    truncated = text[:max_length]
    last_space = truncated.rfind(' ')
    if last_space > max_length // 2:
        truncated = truncated[:last_space]
    
    return truncated.rstrip() + '...'


def format_telegram_message(title: str, text: str, source_name: str, 
                           source_url: str, category: str) -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –Ω–æ–≤–æ—Å—Ç—å –≤ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è Telegram (–∫–æ–º–ø–∞–∫—Ç–Ω–æ–µ, –∫—Ä–∞—Å–∏–≤–æ–µ)
    –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –∫–∞–Ω–∞–ª–µ –±–µ–∑ scroll
    """
    # –£–±–∏—Ä–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏-–ø—Ä–µ—Ñ–∏–∫—Å—ã –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ Lenta.ru –∏ –¥—Ä—É–≥–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
    title = re.sub(r'^(–£—Ö–æ–¥ –∑–∞ —Å–æ–±–æ–π|–ü–æ–ª–∏—Ç–∏–∫–∞|–£–∫—Ä–∞–∏–Ω–∞|–≠–∫–æ–Ω–æ–º–∏–∫–∞|–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å|–û–±—â–µ—Å—Ç–≤–æ|–ö—É–ª—å—Ç—É—Ä–∞|–°–ø–æ—Ä—Ç|–ù–∞—É–∫–∞|–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏|–ü—Ä–µ—Å—Ç—É–ø–Ω–∞—è –†–æ—Å—Å–∏—è|–°–∏–ª–æ–≤—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã|–ü—Ä–∏–±–∞–ª—Ç–∏–∫–∞|–ë—ã–≤—à–∏–π –°–°–°–†|–ú–∏—Ä):\s*', '', title, flags=re.IGNORECASE)
    title = re.sub(r'^(–ó–∞–±–æ—Ç–∞ –æ —Å–µ–±–µ|–ò–∑ –∂–∏–∑–Ω–∏|–°—Ä–µ–¥–∞ –æ–±–∏—Ç–∞–Ω–∏—è|–¶–µ–Ω–Ω–æ—Å—Ç–∏|–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è):\s*', '', title, flags=re.IGNORECASE)
    title = re.sub(r'Lenta\.ru\s*', '', title, flags=re.IGNORECASE)
    title = re.sub(r'(–¢–ê–°–°|–†–ë–ö|–ì–∞–∑–µ—Ç–∞\.Ru|–ö–æ–º–º–µ—Ä—Å–∞–Ω—Ç—ä|–ò–∑–≤–µ—Å—Ç–∏—è|RT|–ò–Ω—Ç–µ—Ä—Ñ–∞–∫—Å|–î–∑–µ–Ω)\s*[‚Äî‚Äì-]\s*', '', title, flags=re.IGNORECASE)
    
    # –§–∏–ª—å—Ç—Ä—É–µ–º —è–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –∏ URLs
    if not title or len(title) < 15:  # –ú–∏–Ω–∏–º—É–º 15 —Å–∏–º–≤–æ–ª–æ–≤
        return ""
    
    if title.startswith("/"):
        return ""  # –ü–æ—Ö–æ–∂–µ –Ω–∞ –∫–æ–º–∞–Ω–¥—É
    
    # –°–ø–∏—Å–æ–∫ UI —Ñ—Ä–∞–∑ –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω—ã
    noise_phrases = [
        '–≤—Å–µ —Ç–µ–º—ã', '–≤—ã–±–µ—Ä–∏—Ç–µ', '–∫–∞—Ç–µ–≥–æ—Ä–∏—è', '–ø–æ–¥–ø–∏—Å–∫–∞',
        '–º–µ–Ω—é', '–Ω–∞–≤–∏–≥–∞—Ü–∏—è', '–≤–æ–π—Ç–∏', '–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä', '—Ä–µ–∫–ª–∞–º–∞',
        '–±–æ–ª—å—à–µ', '–µ—â—ë', '–¥–∞–ª–µ–µ', '—á–∏—Ç–∞—Ç—å', '—Å–≤–µ—Ä–Ω—É—Ç—å', '—Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å',
        '–ø–æ–¥–µ–ª–∏—Ç—å—Å—è', '–æ—à–∏–±–∫–∞', '–∑–∞–≥—Ä—É–∂',
    ]
    
    title_lower = title.lower()
    for phrase in noise_phrases:
        if phrase in title_lower:
            return ""  # –ü–æ—Ö–æ–∂–µ –Ω–∞ UI —ç–ª–µ–º–µ–Ω—Ç
    
    # –û—á–∏—â–∞–µ–º —Ç–µ–∫—Å—Ç
    text = clean_html(text) if text else ""
    
    # –£–±–∏—Ä–∞–µ–º –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã (–≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è —á–µ—Ä—Ç–∞, —Å–ª—ç—à–∏)
    text = text.replace('|', '').replace('\\', '').replace('/', ' ')
    title = title.replace('|', '').replace('\\', '').replace('/', ' ')
    
    # –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –≤ —Ç–µ–∫—Å—Ç–µ
    normalized_title = ' '.join(title.lower().split())
    normalized_text = ' '.join(text.lower().split())
    if normalized_text.startswith(normalized_title):
        # –£–¥–∞–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏–∑ –Ω–∞—á–∞–ª–∞ —Ç–µ–∫—Å—Ç–∞
        text = text[len(title):].strip()
        text = text.lstrip('|:.-').strip()
    
    # –í—ã–±–∏—Ä–∞–µ–º –ª–∏–¥ —á–µ—Ä–µ–∑ lead_extractor
    from utils.lead_extractor import clean_text as clean_lead_text, choose_lead
    lead_candidates = [clean_lead_text(text)] if text else []
    paragraph = choose_lead(lead_candidates, max_len=800)
    if not paragraph and text:
        paragraph = truncate_text(text, max_length=800)
    
    # –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã –¥–ª—è Markdown
    title = escape_markdown(title)
    paragraph = escape_markdown(paragraph)
    source_name = escape_markdown(source_name)
    source_url = escape_markdown(source_url)
    
    # –ö–æ–º–ø–∞–∫—Ç–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ç—Ä–µ–±—É–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç)
    message = f"{title}\n"
    if paragraph:
        paragraph = paragraph.strip()
        message += f"\n{paragraph}\n"
    message += f"\n–ò—Å—Ç–æ—á–Ω–∏–∫: {source_name}\n{source_url}\n\n{category}"
    
    # Hard limit for telegram (1000 chars)
    message = truncate_for_telegram(message, max_length=1000)
    
    return message


def escape_markdown(text: str) -> str:
    """
    –≠–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã Markdown
    """
    # –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–∏–º–≤–æ–ª—ã –¥–ª—è Markdown
    special_chars = ['_', '*', '[', ']', '(', ')', '~', '`']
    for char in special_chars:
        text = text.replace(char, f'\\{char}')
    return text

